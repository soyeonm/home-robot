# @package _global_

defaults:
  - /habitat: habitat_config_base
  - /habitat/task: objectnav
  - /habitat/simulator/agents@habitat.simulator.agents.agent_0: rgbds_agent 
  - /habitat/simulator/agents@habitat.simulator.agents.agent_1: rgbds_agent 
  #- /habitat/simulator/agents@habitat.simulator.agents.main_agent: rgbds_agent 
  - /habitat/dataset/objectnav: hm3d_v2
  - _self_

habitat:
  task:
    #type: NavWithHumanoid-v0 #RearrangeSim-v0
    success_reward: 2.5
    slack_reward: -1e-3
    actions:
      agent_0_robot_nav_action:
        type: RobotNavAction
        agent_index: 0
      #   # For noncylinder navmesh action
      #   # If we allow the agent to do sliding
      #   # allow_dyn_slide: True
      #   # # If the agent is allowed to slide if the agent needs to do rotation
      #   # enable_rotation_check_for_dyn_slide: False
      #   # # The distance threshold of treating collision
      #   # collision_threshold: 0.02
      #   # # The navmesh offset for the action control
      #   # navmesh_offset: [[0.0, 0.0], [0.15, 0.0], [-0.15, 0.0]]
      #   # # The navmesh offset for the agent placement
      #   # navmesh_offset_for_agent_placement: [[0.0, 0.0], [0.15, 0.0], [-0.15, 0.0]]
      #   # enable_lateral_move: False
      #   # turn_thresh: 0.1
      #   # dist_thresh: 0.5
      agent_1_humanoid_nav_action:
        type: HumanoidNavAction
        agent_index: 1
        #motion_control: human_joints

  environment:
    max_episode_steps: 500

  gym:
    obs_keys:
      - agent_0_rgb_sensor
      - agent_1_rgb_sensor
  simulator:
    turn_angle: 30
    tilt_angle: 30
    action_space_config: "v1"
    #Originally in objectnav_hm3d_v2_rgbd_with_semantic
    # agents:
    #   main_agent:
    #     sim_sensors:
    #       rgb_sensor:
    #         width: 640
    #         height: 480
    #         hfov: 79
    #         position: [0, 0.88, 0]
    #       depth_sensor:
    #         width: 640
    #         height: 480
    #         hfov: 79
    #         min_depth: 0.5
    #         max_depth: 5.0
    #         position: [0, 0.88, 0]
    #       semantic_sensor:
    #         width: 640
    #         height: 480
    #         hfov: 79
    #         position: [0, 0.88, 0]
    #     height: 0.88
    #     radius: 0.18
    # habitat_sim_v0:
    #   gpu_device_id: 0
    #   allow_sliding: False
    # gym:
    # obs_keys:
    #   - agent_0_head_depth
    #   - agent_1_head_depth
    #   - agent_0_obj_start_sensor
    #   - agent_1_obj_start_sensor
    #   - agent_0_obj_goal_sensor
    #   - agent_1_obj_goal_sensor
    #   - agent_0_joint
    #   - agent_1_joint
    #TODO: Add sensors for multiagent
      # - agent_0_articulated_agent_arm_depth
      # - agent_0_relative_resting_position
      # - agent_0_obj_start_sensor
      # - agent_0_obj_goal_sensor
      # - agent_0_obj_start_gps_compass
      # - agent_0_obj_goal_gps_compass
      # - agent_0_is_holding
      # - agent_0_ee_pos
      # - agent_0_localization_sensor
      # - agent_0_has_finished_oracle_nav
      # - agent_0_other_agent_gps
      # - agent_1_head_depth
      # - agent_1_relative_resting_position
      # - agent_1_obj_start_sensor
      # - agent_1_obj_goal_sensor
      # - agent_1_obj_start_gps_compass
      # - agent_1_obj_goal_gps_compass
      # - agent_1_is_holding
      # - agent_1_ee_pos
      # - agent_1_localization_sensor
      # - agent_1_has_finished_oracle_nav
      # - agent_1_other_agent_gps
  # simulator:
    # Add Spot robot agents
    agents:
      agent_0:
        radius: 0.25
        height: 1.8
        articulated_agent_urdf: data/robots/hab_spot_arm/urdf/hab_spot_arm.urdf
        articulated_agent_type: "SpotRobot"
        sim_sensors:
          rgb_sensor:
            width: 640
            height: 480
            hfov: 79
            position: [0, 0.736317, 0]
            #position: [0, 0.88, 0]
          depth_sensor:
            width: 640
            height: 480
            hfov: 79
            min_depth: 0.5
            max_depth: 5.0
            position: [0, 0.736317, 0]
          third_rgb_sensor:
            width: 640
            height: 480
            #hfov: 79
            #position: [0, 0.736317, 0]
            #position: [0, 0.88, 0]
          # arm_rgb_sensor:
          #   height: 480
          #   width: 640
          #   hfov: 47
          # arm_depth_sensor:
          #   height: 224
          #   width: 171
          #   hfov: 55
      agent_1:
        radius: 0.3
        articulated_agent_urdf: 'data/humanoids/humanoid_data/female2_0.urdf'
        articulated_agent_type: 'KinematicHumanoid'
        rest_pose_data_path: 'data/humanoids/humanoid_data/standing_pose_smplx.pkl'
        motion_data_path: "data/humanoids/humanoid_data/walking_motion_processed_smplx.pkl"
        sim_sensors:
          rgb_sensor:
            height: 480
            width: 640
            hfov: 79
          third_rgb_sensor:
            width: 640
            height: 480
    kinematic_mode: True
    ac_freq_ratio: 1
    step_physics: False
    # habitat_sim_v0:
    #   allow_sliding: True

    #type: RearrangeSim-v1 #HumanoidNavSim-v0 #RearrangeSim-v0
    seed: 100
    #Just commented out
    # additional_object_paths:
    #   - "data/objects/ycb/configs/"
    #   - "data/objects/amazon_berkeley/configs/"
    #   - "data/objects/google_object_dataset/configs/"
    concur_render: True
    auto_sleep: True
    agents_order:
      - agent_0
      - agent_1
    # agents:
    #   agent_0:
    #     radius: 0.3
    #     articulated_agent_urdf: ./data/robots/hab_fetch/robots/hab_suction.urdf
    #     articulated_agent_type: FetchSuctionRobot
    #     ik_arm_urdf: ./data/robots/hab_fetch/robots/fetch_onlyarm.urdf
    #     joint_start_noise: 0.0
    #   agent_1:
    #     radius: 0.3
    #     # sim_sensors:
    #     #   head_depth_sensor:
    #     #     height: 256
    #     #     width: 256
    #     # A new instance of the sensor is created. The agents do not share a
    #     # depth camera, but instead a different depth camera is created for
    #     # each agent.
    #     articulated_agent_urdf: ./data/robots/hab_fetch/robots/hab_suction.urdf
    #     articulated_agent_type: FetchSuctionRobot

    habitat_sim_v0:
      gpu_device_id: 0 #added from objectnav_hm3d_v2_rgbd_with_semantic
      allow_sliding: False
      enable_physics: True
